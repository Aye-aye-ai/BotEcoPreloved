<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrelovedPro - Live Demo Split View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; height: 100vh; overflow: hidden; }

        /* SCROLLBAR HIDING */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ANIMATIONS */
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { 
            from { opacity: 0; transform: scale(0.9) translateY(10px); } 
            to { opacity: 1; transform: scale(1) translateY(0); } 
        }

        .slide-in-right { animation: slideInRight 0.3s ease-out forwards; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* MODERN CARD */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        /* INPUT STYLING */
        .demo-input {
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }
        .demo-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            outline: none;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <nav class="h-14 bg-slate-900 text-white flex items-center justify-between px-6 shadow-md z-50 shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-rose-600 w-8 h-8 rounded-lg flex items-center justify-center font-bold shadow-lg shadow-rose-500/50">
                <i class="fa-solid fa-bag-shopping"></i>
            </div>
            <div>
                <h1 class="font-bold text-sm tracking-wide">PRELOVED<span class="text-rose-400">PRO</span></h1>
            
            </div>
        </div>

        <div class="flex bg-slate-800 rounded-full p-1 gap-1">
            <button onclick="activateSeller('none')" id="btn-none" class="px-4 py-1.5 rounded-full text-xs font-bold transition bg-slate-700 text-white">
                <i class="fa-solid fa-eye-slash"></i> Tutup Seller
            </button>
            <button onclick="activateSeller('seller1')" id="btn-seller1" class="px-4 py-1.5 rounded-full text-xs font-bold transition text-slate-400 hover:text-white hover:bg-slate-700">
                <i class="fa-solid fa-store"></i> Toko A
            </button>
            <button onclick="activateSeller('seller2')" id="btn-seller2" class="px-4 py-1.5 rounded-full text-xs font-bold transition text-slate-400 hover:text-white hover:bg-slate-700">
                <i class="fa-solid fa-store"></i> Toko B
            </button>
            <button onclick="activateSeller('seller3')" id="btn-seller3" class="px-4 py-1.5 rounded-full text-xs font-bold transition text-slate-400 hover:text-white hover:bg-slate-700">
                <i class="fa-solid fa-store"></i> Toko C
            </button>
        </div>

        <button onclick="resetData()" class="text-xs text-slate-400 hover:text-rose-400">
            <i class="fa-solid fa-trash"></i> Reset Data
        </button>
    </nav>

    <div class="flex-1 flex overflow-hidden relative bg-slate-100">

        <div class="flex-1 flex justify-center bg-slate-100 relative pt-4 pb-4 transition-all duration-300" id="buyer-container">
            
            <div class="w-full max-w-[400px] bg-white rounded-[30px] shadow-2xl overflow-hidden border-[6px] border-slate-900 flex flex-col h-full relative">
                
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-slate-900 rounded-b-xl z-20"></div>

                <div class="pt-8 pb-3 px-4 bg-white border-b border-slate-50 flex justify-between items-center">
                    <h2 class="font-bold text-slate-800">Beranda</h2>
                    <div class="bg-rose-100 text-rose-600 px-2 py-0.5 rounded text-[10px] font-bold">Buyer Mode</div>
                </div>

                <div class="px-4 py-2 border-b border-slate-50 overflow-x-auto no-scrollbar flex gap-2">
                    <button onclick="setCat('Semua')" class="px-3 py-1 rounded-full text-[10px] font-bold bg-slate-900 text-white whitespace-nowrap">Semua</button>
                    <button onclick="setCat('Fashion')" class="px-3 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-500 whitespace-nowrap border hover:bg-rose-50 hover:text-rose-600 transition">Fashion</button>
                    <button onclick="setCat('Gadget')" class="px-3 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-500 whitespace-nowrap border hover:bg-rose-50 hover:text-rose-600 transition">Gadget</button>
                    <button onclick="setCat('Hobi')" class="px-3 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-500 whitespace-nowrap border hover:bg-rose-50 hover:text-rose-600 transition">Hobi</button>
                </div>

                <div id="buyer-feed" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 no-scrollbar">
                    </div>

                <div class="p-3 bg-white border-t border-slate-100 flex gap-2">
                    <input type="text" id="buyer-input" class="flex-1 bg-slate-100 rounded-full px-4 text-xs focus:outline-none focus:ring-2 focus:ring-rose-500 transition" placeholder="Mau cari barang apa?">
                    <button onclick="sendRequest()" class="w-9 h-9 bg-rose-600 text-white rounded-full shadow-lg shadow-rose-200 hover:scale-105 active:scale-95 transition flex items-center justify-center">
                        <i class="fa-solid fa-paper-plane text-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="seller-panel" class="w-0 transition-all duration-300 ease-in-out bg-white border-l border-slate-200 flex flex-col relative overflow-hidden">
            
            <div class="h-16 bg-slate-50 border-b border-slate-200 flex items-center px-6 justify-between shrink-0">
                <div class="flex items-center gap-3">
                    <div id="seller-avatar" class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 font-bold shadow-sm">
                        <i class="fa-solid fa-store"></i>
                    </div>
                    <div>
                        <h2 id="seller-name" class="font-bold text-slate-800 text-sm">Dashboard Toko</h2>
                        <div class="flex items-center gap-1.5">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-[10px] text-slate-500 font-medium">Online & Ready</span>
                        </div>
                    </div>
                </div>
                <button onclick="activateSeller('none')" class="text-slate-400 hover:text-slate-600">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div id="seller-feed" class="flex-1 overflow-y-auto p-6 bg-slate-50 space-y-6">
                </div>

        </div>

    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 translate-y-20 opacity-0 z-[60]">
        <i class="fa-solid fa-circle-check text-emerald-400"></i>
        <span id="toast-msg" class="text-xs font-bold">Action Success</span>
    </div>

    <script>
        // --- DATA STATE ---
        const DB_REQ = 'ph_demo_reqs_v2';
        const DB_OFFER = 'ph_demo_offers_v2';
        
        let activeSellerId = null;
        let activeCategory = 'Semua';

        const SELLERS = {
            'seller1': { name: 'Toko A (Berkah)', color: 'bg-emerald-600', light: 'bg-emerald-50', text: 'text-emerald-600' },
            'seller2': { name: 'Toko B (Gadget)', color: 'bg-indigo-600', light: 'bg-indigo-50', text: 'text-indigo-600' },
            'seller3': { name: 'Toko C (Hobi)', color: 'bg-orange-600', light: 'bg-orange-50', text: 'text-orange-600' }
        };

        // --- INIT ---
        window.onload = () => {
            renderBuyer();
        };

        // --- CONTROLLER LOGIC ---

        function activateSeller(sellerId) {
            activeSellerId = sellerId === 'none' ? null : sellerId;
            const panel = document.getElementById('seller-panel');
            const buyerCont = document.getElementById('buyer-container');
            
            // Reset Button Styles
            ['none', 'seller1', 'seller2', 'seller3'].forEach(id => {
                const btn = document.getElementById('btn-'+id);
                btn.className = "px-4 py-1.5 rounded-full text-xs font-bold transition text-slate-400 hover:text-white hover:bg-slate-700";
            });

            if (activeSellerId) {
                // Open Panel
                panel.style.width = '50%'; // Split screen
                // Highlight Active Button
                const activeBtn = document.getElementById('btn-'+activeSellerId);
                const sData = SELLERS[activeSellerId];
                activeBtn.className = `px-4 py-1.5 rounded-full text-xs font-bold transition text-white ${sData.color.replace('text','bg')}`; // Simple hack to get bg color
                
                // Set Header Info
                document.getElementById('seller-name').innerText = sData.name;
                const avatar = document.getElementById('seller-avatar');
                avatar.className = `w-10 h-10 rounded-full ${sData.light} flex items-center justify-center ${sData.text} font-bold shadow-sm transition-colors duration-300`;
                
                renderSeller(); // Load data for this seller
            } else {
                // Close Panel
                panel.style.width = '0%';
                document.getElementById('btn-none').className = "px-4 py-1.5 rounded-full text-xs font-bold transition bg-slate-700 text-white";
            }
        }

        // --- BUYER LOGIC ---

        function setCat(cat) {
            activeCategory = cat;
            showToast(`Kategori: ${cat}`);
        }

        function sendRequest() {
            const input = document.getElementById('buyer-input');
            if(!input.value.trim()) return;

            const reqs = getStorage(DB_REQ);
            reqs.push({
                id: Date.now(),
                text: input.value,
                cat: activeCategory,
                time: Date.now()
            });
            saveStorage(DB_REQ, reqs);
            input.value = '';
            
            renderBuyer();
            if(activeSellerId) renderSeller(); // Sync if open
        }

        function renderBuyer() {
            const reqs = getStorage(DB_REQ).reverse();
            const offers = getStorage(DB_OFFER);
            const container = document.getElementById('buyer-feed');

            if(reqs.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 opacity-40">
                        <i class="fa-solid fa-basket-shopping text-5xl mb-3 text-slate-300"></i>
                        <p class="text-xs text-slate-500 font-medium">Belum ada request</p>
                    </div>`;
                return;
            }

            container.innerHTML = reqs.map(r => {
                const items = offers.filter(o => o.reqId == r.id).sort((a,b) => a.price - b.price);
                
                return `
                <div class="pop-in group mb-6">
                    <div class="flex justify-end mb-2">
                        <div class="bg-slate-800 text-white px-4 py-2.5 rounded-2xl rounded-tr-sm text-xs shadow-md max-w-[85%] relative">
                            <span class="absolute -top-4 right-0 text-[9px] text-slate-400 font-bold bg-white px-1.5 rounded border">${r.cat}</span>
                            "${r.text}"
                        </div>
                    </div>

                    <div class="flex items-center gap-2 mb-3 px-2">
                        <div class="h-px bg-slate-200 flex-1"></div>
                        <span class="text-[9px] font-bold text-slate-400 uppercase tracking-wider">
                            ${items.length} Penawaran
                        </span>
                        <div class="h-px bg-slate-200 flex-1"></div>
                    </div>

                    ${items.length > 0 ? `
                        <div class="grid grid-cols-1 gap-3">
                            ${items.map(item => `
                                <div class="bg-white p-2.5 rounded-xl border border-slate-100 shadow-sm flex gap-3 transition hover:shadow-md">
                                    <div class="w-16 h-16 bg-slate-100 rounded-lg overflow-hidden shrink-0">
                                        <img src="${item.img}" class="w-full h-full object-cover">
                                    </div>
                                    <div class="flex-1 flex flex-col justify-between">
                                        <div>
                                            <div class="flex justify-between items-start">
                                                <h4 class="font-bold text-xs text-slate-700 line-clamp-1">${item.item}</h4>
                                                <span class="text-[9px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold">${item.cond}</span>
                                            </div>
                                            <p class="text-[10px] text-slate-400 mt-0.5"><i class="fa-solid fa-store"></i> ${item.sellerName}</p>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <span class="text-xs font-bold text-rose-600">Rp ${parseInt(item.price).toLocaleString()}</span>
                                            <button onclick="window.open('https://wa.me/${item.phone}?text=Minat ${item.item}', '_blank')" class="w-6 h-6 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:scale-110 transition">
                                                <i class="fa-brands fa-whatsapp text-[10px]"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="bg-white border-2 border-dashed border-slate-100 rounded-xl p-3 text-center">
                            <i class="fa-solid fa-hourglass-half text-slate-300 mb-1"></i>
                            <p class="text-[10px] text-slate-400">Menunggu seller...</p>
                        </div>
                    `}
                </div>
                `;
            }).join('');
            
            // Auto scroll to bottom if new msg
            // container.scrollTop = container.scrollHeight;
        }

        // --- SELLER LOGIC ---

        function renderSeller() {
            if(!activeSellerId) return;
            
            const reqs = getStorage(DB_REQ).reverse();
            const offers = getStorage(DB_OFFER);
            const container = document.getElementById('seller-feed');
            const sData = SELLERS[activeSellerId];

            if(reqs.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-400 text-sm mt-10">Belum ada request.</div>`;
                return;
            }

            container.innerHTML = reqs.map(r => {
                // Filter barang yang SUDAH dikirim oleh seller INI untuk request INI
                const myItems = offers.filter(o => o.reqId == r.id && o.sellerId == activeSellerId);

                return `
                <div class="bg-white p-5 rounded-2xl shadow-[0_2px_15px_rgba(0,0,0,0.05)] border border-slate-100 slide-in-right relative overflow-hidden group">
                    <div class="absolute top-0 left-0 w-1 h-full ${sData.color}"></div>
                    
                    <div class="flex justify-between items-start mb-4 pl-2">
                        <div>
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">REQUEST PEMBELI</span>
                            <h3 class="text-slate-800 font-bold text-lg leading-tight mt-1">"${r.text}"</h3>
                            <span class="inline-block mt-2 bg-slate-100 text-slate-500 text-[10px] font-bold px-2 py-0.5 rounded-full">${r.cat}</span>
                        </div>
                    </div>

                    ${myItems.length > 0 ? `
                    <div class="mb-4 pl-2">
                        <p class="text-[10px] text-slate-400 font-bold mb-2">PENAWARAN KAMU (${myItems.length})</p>
                        <div class="flex gap-2">
                            ${myItems.map(m => `
                                <img src="${m.img}" class="w-8 h-8 rounded border border-slate-200 object-cover opacity-80" title="${m.item}">
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <div class="bg-slate-50/80 p-4 rounded-xl border border-slate-100 transition-all hover:bg-white hover:shadow-md pl-2">
                        <div class="flex gap-3 mb-3">
                            <label class="w-20 h-20 bg-white border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-indigo-400 transition relative overflow-hidden shrink-0 group/img">
                                <input type="file" id="file-${r.id}" class="hidden" onchange="previewImg(this, ${r.id})">
                                <i class="fa-solid fa-camera text-slate-300 text-xl group-hover/img:text-indigo-400 transition" id="icon-${r.id}"></i>
                                <img id="img-${r.id}" class="absolute inset-0 w-full h-full object-cover hidden">
                            </label>

                            <div class="flex-1 space-y-2">
                                <input id="name-${r.id}" type="text" placeholder="Nama Barang" class="w-full text-xs p-2 rounded-lg demo-input bg-white">
                                <div class="flex gap-2">
                                    <input id="price-${r.id}" type="number" placeholder="Harga" class="w-2/3 text-xs p-2 rounded-lg demo-input bg-white">
                                    <select id="cond-${r.id}" class="w-1/3 text-xs p-1 rounded-lg demo-input bg-white">
                                        <option>Bekas</option>
                                        <option>Baru</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative mb-3">
                            <input id="phone-${r.id}" type="tel" placeholder="Nomor WA (0812...)" class="w-full text-xs pl-8 p-2 rounded-lg demo-input bg-white" value="${getLastPhone()}">
                            <i class="fa-brands fa-whatsapp absolute left-3 top-2.5 text-emerald-500 text-xs"></i>
                        </div>

                        <button onclick="submitOffer(${r.id})" class="w-full ${sData.color} text-white py-2.5 rounded-lg text-xs font-bold shadow-md hover:opacity-90 active:scale-95 transition flex justify-center items-center gap-2">
                            <i class="fa-solid fa-paper-plane"></i> Kirim Penawaran
                        </button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function submitOffer(reqId) {
            const nameEl = document.getElementById(`name-${reqId}`);
            const priceEl = document.getElementById(`price-${reqId}`);
            const condEl = document.getElementById(`cond-${reqId}`);
            const phoneEl = document.getElementById(`phone-${reqId}`);
            const imgEl = document.getElementById(`img-${reqId}`);
            
            if(!nameEl.value || !priceEl.value || !phoneEl.value || imgEl.classList.contains('hidden')) {
                return showToast("⚠️ Lengkapi semua data!", true);
            }

            const offers = getStorage(DB_OFFER);
            const sData = SELLERS[activeSellerId];

            offers.push({
                id: Date.now(),
                reqId: reqId,
                sellerId: activeSellerId,
                sellerName: sData.name,
                item: nameEl.value,
                price: priceEl.value,
                cond: condEl.value,
                phone: phoneEl.value,
                img: imgEl.src
            });

            // Save phone to localStorage for convenience
            localStorage.setItem('last_phone', phoneEl.value);

            try {
                saveStorage(DB_OFFER, offers);
                showToast("✅ Penawaran Terkirim!");
                
                // Reset Form (keep phone)
                nameEl.value = '';
                priceEl.value = '';
                imgEl.src = '';
                imgEl.classList.add('hidden');
                document.getElementById(`icon-${reqId}`).classList.remove('hidden');

                // Refresh Both Sides
                renderSeller();
                renderBuyer();
            } catch(e) {
                alert("Storage penuh.");
            }
        }

        // --- UTILS ---
        function getStorage(k) { return JSON.parse(localStorage.getItem(k) || '[]'); }
        function saveStorage(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
        function resetData() { if(confirm("Reset semua data demo?")) { localStorage.clear(); location.reload(); } }
        function getLastPhone() { return localStorage.getItem('last_phone') || ''; }
        
        function previewImg(input, id) {
            if(input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(`img-${id}`);
                    const icon = document.getElementById(`icon-${id}`);
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    icon.classList.add('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            t.innerHTML = isError ? `<i class="fa-solid fa-triangle-exclamation text-rose-400"></i> ${msg}` : `<i class="fa-solid fa-circle-check text-emerald-400"></i> ${msg}`;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        // Enter key helper
        document.getElementById('buyer-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendRequest(); });

    </script>
</body>
</html>